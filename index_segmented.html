<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neural Audio Codec Segmented Evaluation Results</title>
    <style>
        * { box-sizing: border-box; }
        
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 30px;
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            font-size: 14px;
            margin-bottom: 30px;
        }
        
        .navigation {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 25px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            border: 1px solid #ddd;
        }

        .nav-button {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            font-weight: bold;
            font-size: 14px;
            transition: background 0.3s;
        }

        .nav-button:hover { background: #0056b3; }
        .nav-button.active { background: #28a745; }
        .nav-button.github { background: #24292e; }
        .nav-button.github:hover { background: #1a1e22; }
        
        .controls {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        
        .control-row {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .control-row:last-child { margin-bottom: 0; }
        
        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
            background: white;
            padding: 8px 12px;
            border-radius: 4px;
            border: 1px solid #e0e0e0;
            flex: 1;
            min-width: 0;
        }
        
        .control-group label {
            font-weight: bold;
            color: #555;
            margin-right: 10px;
        }
        
        .control-group.first-aligned label {
            min-width: 100px;
            text-align: left;
        }
        
        .control-subgroup {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: 10px;
            flex-wrap: wrap;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .checkbox-group input[type="checkbox"] { margin-right: 5px; }
        
        .checkbox-group label {
            font-weight: normal;
            color: #555;
            font-size: 14px;
        }
        
        select {
            padding: 4px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            min-width: 70px;
            font-size: 12px;
        }
        
        .status-info {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        .codec-section {
            margin-bottom: 50px;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .codec-header {
            background: #495057;
            color: white;
            padding: 15px 20px;
            font-size: 20px;
            font-weight: bold;
        }
        
        .experiment-section {
            border-bottom: 2px solid #ddd;
        }
        
        .experiment-section:last-child {
            border-bottom: none;
        }
        
        .experiment-header {
            background: #6c757d;
            color: white;
            padding: 12px 20px;
            font-size: 16px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .experiment-tag {
            background: #fff3cd;
            color: #856404;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 14px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 0;
            font-size: 12px;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 8px 6px;
            text-align: center;
            vertical-align: middle;
        }
        
        th {
            background-color: #f8f9fa;
            font-weight: bold;
            color: #495057;
            font-size: 11px;
        }
        
        .file-id {
            font-family: monospace;
            font-size: 11px;
            font-weight: bold;
            color: #495057;
            text-align: left;
            padding-left: 10px;
            min-width: 120px;
        }
        
        .audio-controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 3px;
        }
        
        .codec-info {
            font-size: 10px;
            color: #666;
            margin-top: 2px;
        }
        
        .transcript {
            max-width: 200px;
            text-align: left;
            font-size: 10px;
            line-height: 1.3;
            color: #555;
            padding: 4px;
        }
        
        .play-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            margin-bottom: 3px;
        }
        
        .play-button:hover { background: #0056b3; }
        .play-button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }

        .total-row {
            background-color: #e3f2fd !important;
            font-weight: bold;
        }

        .error-example {
            background-color: rgba(255, 193, 193, 0.3) !important;
        }
        
        .error-example .file-id {
            color: #d32f2f;
            font-weight: bold;
        }

        .no-audio {
            color: #666;
            font-style: italic;
        }

        .metric-cell {
            font-size: 12px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Neural Audio Codec Segmented Evaluation Results</h1>
        <div class="subtitle">Comparison of codec performance on segmented audio samples</div>
        
        <div class="navigation">
            <a href="index.html" class="nav-button">Original Experiments</a>
            <a href="index_segmented.html" class="nav-button active">Segmented Experiments</a>
            <a href="https://github.com/Jie-shiang/Codec_comparison" target="_blank" class="nav-button github">GitHub Repository</a>
        </div>
        
        <div class="status-info" id="status-info">
            Loading configurations...
        </div>
        
        <div class="controls">
            <div class="control-row">
                <div class="control-group first-aligned">
                    <label>Segment Length:</label>
                    <div class="control-subgroup">
                        <div class="checkbox-group">
                            <input type="checkbox" id="seg-0.5s" value="0.5s" onchange="updateDisplay()">
                            <label for="seg-0.5s">0.5s</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="seg-1.0s" value="1.0s" checked onchange="updateDisplay()">
                            <label for="seg-1.0s">1.0s</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="seg-2.0s" value="2.0s" onchange="updateDisplay()">
                            <label for="seg-2.0s">2.0s</label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="control-row">
                <div class="control-group first-aligned">
                    <label>NACs</label>
                    <div class="control-subgroup">
                        <div class="checkbox-group">
                            <input type="checkbox" id="show-lscodec" checked onchange="updateDisplay()">
                            <label for="show-lscodec">LSCodec</label>
                            <select id="lscodec-freq" onchange="updateDisplay()">
                                <option value="25Hz">25Hz</option>
                                <option value="50Hz">50Hz</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <div class="control-row">
                <div class="control-group">
                    <label>Dataset Type:</label>
                    <select id="dataset-type" onchange="updateDisplay()">
                        <option value="librispeech">LibriSpeech</option>
                        <option value="commonvoice">CommonVoice</option>
                    </select>
                </div>
            </div>

            <div class="control-row">
                <div class="control-group first-aligned">
                    <label>Display</label>
                    <div class="control-subgroup">
                        <div class="checkbox-group">
                            <input type="checkbox" id="show-original" checked onchange="updateDisplay()">
                            <label for="show-original">Original</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="show-total" checked onchange="updateDisplay()">
                            <label for="show-total">Total</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="show-sample" checked onchange="updateDisplay()">
                            <label for="show-sample">Sample</label>
                            <select id="sample-count" onchange="updateDisplay()">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5" selected>5</option>
                            </select>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="show-error" checked onchange="updateDisplay()">
                            <label for="show-error">Error Example</label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="control-row">
                <div class="control-group first-aligned">
                    <label>Metrics</label>
                    <div class="control-subgroup">
                        <div class="checkbox-group">
                            <input type="checkbox" id="show-dwer" checked onchange="updateDisplay()">
                            <label for="show-dwer">dWER/dCER</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="show-utmos" checked onchange="updateDisplay()">
                            <label for="show-utmos">UTMOS</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="show-pesq" checked onchange="updateDisplay()">
                            <label for="show-pesq">PESQ</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="show-stoi" checked onchange="updateDisplay()">
                            <label for="show-stoi">STOI</label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="control-row">
                <div class="control-group first-aligned">
                    <label>Text</label>
                    <div class="control-subgroup">
                        <div class="checkbox-group">
                            <input type="checkbox" id="show-transcription" onchange="updateDisplay()">
                            <label for="show-transcription">Transcription</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="show-origin" onchange="updateDisplay()">
                            <label for="show-origin">Origin</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="show-inference" onchange="updateDisplay()">
                            <label for="show-inference">Inference Text</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="results"></div>
    </div>

    <script>
        const datasets = {
            librispeech: {
                files: ['Total', 'Sample_1', 'Sample_2', 'Sample_3', 'Sample_4', 'Sample_5', 'Error_Sample_1'],
                errorExamples: ['Error_Sample_1'],
                codecData: {}
            },
            commonvoice: {
                files: ['Total', 'Sample_1', 'Sample_2', 'Sample_3', 'Sample_4', 'Sample_5', 'Error_Sample_1'],
                errorExamples: ['Error_Sample_1'],
                codecData: {}
            }
        };

        let currentModel = 'LSCodec';
        let currentFrequency = '50Hz';
        let currentSegment = '1.0s';

        async function loadCodecData(dataset, codecType, frequency, segment) {
            const basePath = `configs_${segment}`;
            const jsonPath = `${basePath}/${codecType}_${frequency}_config.json`;
            
            try {
                const response = await fetch(jsonPath);
                if (response.ok) {
                    const data = await response.json();
                    
                    if (!datasets[dataset].codecData[codecType]) {
                        datasets[dataset].codecData[codecType] = {};
                    }
                    if (!datasets[dataset].codecData[codecType][frequency]) {
                        datasets[dataset].codecData[codecType][frequency] = {};
                    }
                    
                    datasets[dataset].codecData[codecType][frequency][segment] = data;
                    console.log(`✓ Loaded: ${jsonPath} for ${dataset}`);
                    return data;
                } else {
                    console.warn(`✗ Failed to load ${jsonPath}: ${response.status}`);
                    return null;
                }
            } catch (error) {
                console.error(`✗ Error loading ${jsonPath}:`, error);
                return null;
            }
        }

        async function loadAllConfigs() {
            const statusInfo = document.getElementById('status-info');
            const loadPromises = [];
            
            const segments = ['0.5s', '1.0s', '2.0s'];
            const frequencies = ['25Hz', '50Hz'];
            const datasetNames = Object.keys(datasets);
            
            for (const datasetName of datasetNames) {
                for (const segment of segments) {
                    for (const freq of frequencies) {
                        statusInfo.textContent = `Loading ${datasetName} ${segment} ${freq} data...`;
                        loadPromises.push(loadCodecData(datasetName, 'LSCodec', freq, segment));
                    }
                }
            }
            
            await Promise.all(loadPromises);
            
            statusInfo.textContent = 'All codec data loaded successfully!';
            setTimeout(() => {
                statusInfo.style.display = 'none';
            }, 2000);
            
            updateDisplay();
        }

        function getCodecData(dataset, codecType, frequency, segment, fileId, dataType) {
            try {
                const codecData = datasets[dataset].codecData[codecType]?.[frequency]?.[segment];
                if (!codecData) {
                    console.warn(`No codec data for ${dataset} ${codecType} ${frequency} ${segment}`);
                    return null;
                }
                
                const datasetKey = getDatasetKey(dataset);
                const fileData = codecData[datasetKey]?.[fileId];
                
                if (!fileData) {
                    console.warn(`No file data for ${fileId} in ${datasetKey}`);
                    return null;
                }
                
                switch (dataType) {
                    case 'transcription':
                        return fileData.Transcription || null;
                    case 'origin':
                        return fileData.Origin || null;
                    case 'inference':
                        return fileData.Inference || null;
                    case 'utmos':
                        return fileData.UTMOS || null;
                    case 'dwer':
                        return fileData.dWER || fileData.dCER || null;
                    case 'pesq':
                        return fileData.PESQ || null;
                    case 'stoi':
                        return fileData.STOI || null;
                    case 'filename':
                        return fileData.File_name || null;
                    default:
                        return null;
                }
            } catch (error) {
                console.error('Error getting codec data:', error);
                return null;
            }
        }

        function getDatasetKey(dataset) {
            switch(dataset) {
                case 'librispeech':
                    return 'LibriSpeech';
                case 'commonvoice':
                    return 'CommonVoice';
                default:
                    return 'LibriSpeech';
            }
        }

        function getSelectedSegments() {
            const segments = [];
            if (document.getElementById('seg-0.5s').checked) segments.push('0.5s');
            if (document.getElementById('seg-1.0s').checked) segments.push('1.0s');
            if (document.getElementById('seg-2.0s').checked) segments.push('2.0s');
            return segments;
        }

        function updateDisplay() {
            const resultsDiv = document.getElementById('results');
            const statusDiv = document.getElementById('status-info');
            
            const selectedSegments = getSelectedSegments();
            const showLSCodec = document.getElementById('show-lscodec').checked;
            const frequency = document.getElementById('lscodec-freq').value;
            
            if (selectedSegments.length === 0) {
                statusDiv.style.display = 'block';
                statusDiv.innerHTML = '⚠️ Please select at least one segment length.';
                resultsDiv.innerHTML = '';
                return;
            }

            if (!showLSCodec) {
                statusDiv.style.display = 'block';
                statusDiv.innerHTML = '⚠️ Please select at least one codec.';
                resultsDiv.innerHTML = '';
                return;
            }

            currentModel = 'LSCodec';
            currentFrequency = frequency;

            let html = '<div class="codec-section">';
            html += '<div class="codec-header">LSCodec</div>';
            
            for (const segment of selectedSegments) {
                currentSegment = segment;
                html += createExperimentSection('LSCodec', frequency, segment);
            }
            
            html += '</div>';
            
            statusDiv.style.display = 'none';
            resultsDiv.innerHTML = html;
        }

        function createExperimentSection(codecType, frequency, segment) {
            const datasetType = document.getElementById('dataset-type').value;
            const datasetName = datasetType.charAt(0).toUpperCase() + datasetType.slice(1);
            
            let html = '<div class="experiment-section">';
            html += '<div class="experiment-header">';
            html += `<span>${datasetName}</span>`;
            html += `<span class="experiment-tag">${frequency}</span>`;
            html += `<span class="experiment-tag">${segment}</span>`;
            html += '</div>';
            
            html += createDataTable(datasetType, codecType, frequency, segment);
            html += '</div>';
            
            return html;
        }

        function createDataTable(dataset, codecType, frequency, segment) {
            const sampleCount = parseInt(document.getElementById('sample-count').value);
            const files = ['Total', ...Array.from({length: sampleCount}, (_, i) => `Sample_${i + 1}`), 'Error_Sample_1'];
            
            let html = '<table><thead><tr>';
            html += createTableHeaders(dataset);
            html += '</tr></thead><tbody>';
            
            for (const fileId of files) {
                const row = createTableRow(dataset, codecType, frequency, segment, fileId);
                if (row) html += row;
            }
            
            html += '</tbody></table>';
            
            return html;
        }

        function createTableHeaders(dataset) {
            let headers = '<th style="width: 120px;">File ID</th>';
            
            if (document.getElementById('show-original').checked) {
                headers += '<th style="width: 190px;">Original</th>';
            }
            
            if (document.getElementById('show-lscodec').checked) {
                headers += '<th style="width: 190px;">Inference</th>';
            }
            
            if (document.getElementById('show-dwer').checked) {
                const metricType = dataset.includes('commonvoice') ? 'dCER' : 'dWER';
                headers += `<th style="width: 90px;">${metricType}</th>`;
            }
            if (document.getElementById('show-utmos').checked) {
                headers += '<th style="width: 90px;">UTMOS</th>';
            }
            if (document.getElementById('show-pesq').checked) {
                headers += '<th style="width: 90px;">PESQ</th>';
            }
            if (document.getElementById('show-stoi').checked) {
                headers += '<th style="width: 90px;">STOI</th>';
            }
            if (document.getElementById('show-transcription').checked) {
                headers += '<th style="width: 200px;">Transcription</th>';
            }
            if (document.getElementById('show-origin').checked) {
                headers += '<th style="width: 200px;">Origin</th>';
            }
            if (document.getElementById('show-inference').checked) {
                headers += '<th style="width: 200px;">Inference Text</th>';
            }
            
            return headers;
        }

        function createTableRow(dataset, codecType, frequency, segment, fileId) {
            const showTotal = document.getElementById('show-total').checked;
            const showSample = document.getElementById('show-sample').checked;
            const showError = document.getElementById('show-error').checked;
            
            const isTotalRow = fileId === 'Total';
            const isErrorExample = fileId.startsWith('Error_Sample');
            
            if (isTotalRow && !showTotal) return '';
            if (!isTotalRow && !isErrorExample && !showSample) return '';
            if (isErrorExample && !showError) return '';
            
            let rowClass = '';
            if (isTotalRow) rowClass = 'total-row';
            else if (isErrorExample) rowClass = 'error-example';
            
            const dwer = getCodecData(dataset, codecType, frequency, segment, fileId, 'dwer') || 'X';
            const utmos = getCodecData(dataset, codecType, frequency, segment, fileId, 'utmos') || 'X';
            const pesq = getCodecData(dataset, codecType, frequency, segment, fileId, 'pesq') || 'X';
            const stoi = getCodecData(dataset, codecType, frequency, segment, fileId, 'stoi') || 'X';
            
            let transcription = 'X';
            let origin = 'X';
            let inference = 'X';
            let displayFileName = fileId;
            
            if (!isTotalRow) {
                transcription = getCodecData(dataset, codecType, frequency, segment, fileId, 'transcription') || 'X';
                origin = getCodecData(dataset, codecType, frequency, segment, fileId, 'origin') || 'X';
                inference = getCodecData(dataset, codecType, frequency, segment, fileId, 'inference') || 'X';
                const realFileName = getCodecData(dataset, codecType, frequency, segment, fileId, 'filename');
                if (realFileName) displayFileName = realFileName;
            } else {
                transcription = '-';
                origin = '-';
                inference = '-';
            }
            
            let html = `<tr class="${rowClass}">`;
            html += `<td class="file-id">${displayFileName}</td>`;
            
            if (document.getElementById('show-original').checked) {
                html += `<td>${createAudioControl(dataset, displayFileName, 'original', null, segment)}</td>`;
            }
            
            if (document.getElementById('show-lscodec').checked) {
                html += `<td>${createAudioControl(dataset, displayFileName, 'lscodec', frequency, segment)}</td>`;
            }
            
            if (document.getElementById('show-dwer').checked) html += `<td class="metric-cell">${dwer}</td>`;
            if (document.getElementById('show-utmos').checked) html += `<td class="metric-cell">${utmos}</td>`;
            if (document.getElementById('show-pesq').checked) html += `<td class="metric-cell">${pesq}</td>`;
            if (document.getElementById('show-stoi').checked) html += `<td class="metric-cell">${stoi}</td>`;
            if (document.getElementById('show-transcription').checked) html += `<td class="transcript">${transcription}</td>`;
            if (document.getElementById('show-origin').checked) html += `<td class="transcript">${origin}</td>`;
            if (document.getElementById('show-inference').checked) html += `<td class="transcript">${inference}</td>`;
            
            html += '</tr>';
            
            return html;
        }

        function createAudioControl(dataset, fileName, codecType, frequency, segment) {
            if (fileName === 'Total' || fileName === 'X' || fileName === 'N/A') {
                return '<span class="no-audio">-</span>';
            }
            
            const basePath = `audio_${segment}`;
            const datasetPath = dataset === 'librispeech' ? 'LibriSpeech' : 'CommonVoice';
            const cleanFileName = fileName.replace(/\.(wav|flac|mp3)$/, '');
            
            let audioPath = '';
            if (codecType === 'original') {
                audioPath = `${basePath}/${datasetPath}/original/${cleanFileName}`;
            } else if (codecType === 'lscodec') {
                audioPath = `${basePath}/${datasetPath}/LSCodec/${frequency}/${cleanFileName}.wav`;
            }
            
            if (!audioPath) {
                return '<span class="no-audio">No File</span>';
            }
            
            const audioId = `audio_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
            
            let html = '<div class="audio-controls">';
            html += `<button class="play-button" onclick="toggleAudio('${audioId}', this)">Play</button>`;
            html += `<audio preload="none" id="${audioId}">`;
            
            if (codecType === 'original') {
                html += `<source src="${audioPath}.flac" type="audio/flac">`;
                html += `<source src="${audioPath}.mp3" type="audio/mpeg">`;
                html += `<source src="${audioPath}.wav" type="audio/wav">`;
            } else {
                html += `<source src="${audioPath}" type="audio/wav">`;
            }
            
            html += '</audio>';
            
            if (frequency) {
                html += `<div class="codec-info">${frequency}</div>`;
            }
            
            html += '</div>';
            
            return html;
        }

        function toggleAudio(audioId, button) {
            const audio = document.getElementById(audioId);
            
            if (!audio) return;
            
            const allAudios = document.querySelectorAll('audio');
            allAudios.forEach(a => {
                if (a.id !== audioId && !a.paused) {
                    a.pause();
                    a.currentTime = 0;
                }
            });
            
            const allButtons = document.querySelectorAll('.play-button');
            allButtons.forEach(b => {
                if (b !== button) {
                    b.textContent = 'Play';
                    b.disabled = false;
                }
            });
            
            if (audio.paused) {
                button.textContent = 'Loading...';
                button.disabled = true;
                
                audio.play().then(() => {
                    button.textContent = 'Pause';
                    button.disabled = false;
                }).catch(error => {
                    console.error('Error playing audio:', error);
                    button.textContent = 'Error';
                    setTimeout(() => {
                        button.textContent = 'Play';
                        button.disabled = false;
                    }, 2000);
                });
            } else {
                audio.pause();
                button.textContent = 'Play';
            }
            
            audio.onended = () => {
                button.textContent = 'Play';
                button.disabled = false;
            };
        }

        window.onload = function() {
            loadAllConfigs();
        };
    </script>
</body>
</html>