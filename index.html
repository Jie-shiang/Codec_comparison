<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neural Audio Codec Inference Result Comparison</title>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 30px;
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        
        .status-info {
            text-align: center;
            padding: 10px;
            margin-bottom: 20px;
            background: #e3f2fd;
            border-radius: 5px;
            font-weight: bold;
            color: #1976d2;
        }
        
        .controls {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        
        .control-row {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .control-row:last-child {
            margin-bottom: 0;
        }
        
        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
            background: white;
            padding: 8px 12px;
            border-radius: 4px;
            border: 1px solid #e0e0e0;
            flex: 1;
            min-width: 0;
        }
        
        .control-group label {
            font-weight: bold;
            color: #555;
            margin-right: 10px;
        }
        
        .control-group.first-aligned label {
            min-width: 60px;
            text-align: left;
        }
        
        .control-subgroup {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: 10px;
            flex-wrap: wrap;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .checkbox-group input[type="checkbox"] {
            margin-right: 5px;
        }
        
        .checkbox-group label {
            font-weight: normal;
            color: #555;
            font-size: 14px;
        }
        
        .checkbox-group select {
            padding: 4px 8px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 13px;
            background: white;
        }
        
        .model-section {
            margin-bottom: 40px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .model-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            font-size: 20px;
            font-weight: bold;
            text-align: center;
        }
        
        .model-info {
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }
        
        .params-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .info-item {
            background: white;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #dee2e6;
        }
        
        .info-label {
            font-size: 11px;
            color: #666;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .info-value {
            font-size: 14px;
            color: #333;
            font-weight: bold;
        }
        
        .training-testing-table {
            width: 100%;
            margin-top: 10px;
        }
        
        .training-testing-table .label-cell {
            background: #e9ecef;
            font-weight: bold;
            width: 150px;
            text-align: center;
        }
        
        .training-testing-table .value-cell {
            background: white;
        }
        
        .dataset-section {
            margin-bottom: 30px;
        }
        
        .dataset-title {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
            padding: 8px 15px;
            background: #e9ecef;
            border-radius: 5px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            font-size: 12px;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 8px 6px;
            text-align: center;
            vertical-align: middle;
        }
        
        th {
            background-color: #f8f9fa;
            font-weight: bold;
            color: #495057;
            font-size: 11px;
        }
        
        .file-id {
            font-family: monospace;
            font-size: 11px;
            font-weight: bold;
            color: #495057;
            text-align: left;
            padding-left: 10px;
            min-width: 120px;
        }
        
        .audio-controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 3px;
        }
        
        .codec-info {
            font-size: 10px;
            color: #666;
            margin-top: 2px;
        }
        
        .transcript {
            max-width: 200px;
            text-align: left;
            font-size: 10px;
            line-height: 1.3;
            color: #555;
            padding: 4px;
        }
        
        .play-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            margin-bottom: 3px;
        }
        
        .play-button:hover {
            background: #0056b3;
        }
        
        .play-button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }

        .total-row {
            background-color: #e3f2fd !important;
            font-weight: bold;
        }

        .error-example {
            background-color: rgba(255, 193, 193, 0.3) !important;
        }
        
        .error-example .file-id {
            color: #d32f2f;
            font-weight: bold;
        }

        .no-audio {
            color: #666;
            font-style: italic;
        }

        .metric-cell {
            font-size: 12px;
            font-weight: bold;
        }

        .navigation {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 25px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            border: 1px solid #ddd;
        }

        .nav-button {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            font-weight: bold;
            font-size: 14px;
            transition: background 0.3s;
            border: none;
            cursor: pointer;
        }

        .nav-button:hover {
            background: #0056b3;
        }

        .nav-button.active {
            background: #28a745;
        }

        .nav-button.github {
            background: #24292e;
        }

        .nav-button.github:hover {
            background: #1a1e22;
        }        
    </style>
</head>
<body>
    <div class="container">
        <h1>Neural Audio Codec Inference Result Comparison</h1>

        <div class="navigation">
            <a href="index.html" class="nav-button active">Original Experiments</a>
            <a href="index_segmented.html" class="nav-button">Segmented Experiments</a>
            <a href="index_noise.html" class="nav-button">Noise Experiments</a>
            <a href="https://github.com/Jie-shiang/Codec_comparison" target="_blank" class="nav-button github">GitHub Repository</a>
        </div>
        
        <div class="status-info" id="status-info">
            Loading codec data...
        </div>
        
        <div class="controls">
            <div class="control-row">
                <div class="control-group first-aligned">
                    <label>NACs</label>
                    <div class="control-subgroup" id="codec-controls">
                        <!-- 動態生成 -->
                    </div>
                </div>
            </div>
            
            <div class="control-row">
                <div class="control-group first-aligned">
                    <label>Display</label>
                    <div class="control-subgroup">
                        <div class="checkbox-group">
                            <input type="checkbox" id="show-config" checked>
                            <label for="show-config">Config</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="show-dataset" checked>
                            <label for="show-dataset">Dataset</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="show-original" checked>
                            <label for="show-original">Original</label>
                        </div>
                    </div>
                </div>
                
                <div class="control-group first-aligned">
                    <label>Data</label>
                    <div class="control-subgroup">
                        <select id="dataset-type">
                            <option value="both">Both</option>
                            <option value="librispeech">LibriSpeech</option>
                            <option value="commonvoice">Common Voice</option>
                        </select>
                    </div>
                </div>
                
                <div class="control-group first-aligned">
                    <label>Samples</label>
                    <div class="control-subgroup">
                        <div class="checkbox-group">
                            <input type="checkbox" id="show-total" checked>
                            <label for="show-total">Total</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="show-sample" checked>
                            <label for="show-sample">Sample</label>
                            <select id="sample-count">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5" selected>5</option>
                            </select>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="show-error" checked>
                            <label for="show-error">Error</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="control-row">
                <div class="control-group first-aligned">
                    <label>Metrics</label>
                    <div class="control-subgroup">
                        <div class="checkbox-group">
                            <input type="checkbox" id="show-dwer" checked>
                            <label for="show-dwer">dWER/dCER</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="show-utmos" checked>
                            <label for="show-utmos">UTMOS</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="show-pesq" checked>
                            <label for="show-pesq">PESQ</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="show-stoi" checked>
                            <label for="show-stoi">STOI</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="show-speaker-sim" checked>
                            <label for="show-speaker-sim">Speaker Sim</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="control-row">
                <div class="control-group first-aligned">
                    <label>Text</label>
                    <div class="control-subgroup">
                        <div class="checkbox-group">
                            <input type="checkbox" id="show-transcription">
                            <label for="show-transcription">Transcription</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="show-origin">
                            <label for="show-origin">Origin</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="show-inference">
                            <label for="show-inference">Inference</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="model-sections"></div>
    </div>

    <script src="docs/codec_loader.js"></script>
    <script>
        // Initialize CodecLoader
        const codecLoader = new CodecLoader(
            'docs/codecs_config.json',
            'audio',
            'configs'
        );
        
        let codecsConfig = null;
        let currentModel = null;
        let currentFrequency = null;

        // Load all codec configurations and data
        async function loadAllCodecData() {
            const statusInfo = document.getElementById('status-info');
            
            try {
                // Load codecs configuration
                codecsConfig = await codecLoader.loadCodecsConfig();
                
                if (!codecsConfig) {
                    statusInfo.textContent = 'Failed to load codec configuration';
                    statusInfo.style.background = '#ffebee';
                    statusInfo.style.color = '#c62828';
                    return;
                }
                
                // Dynamically generate codec controls
                renderCodecControls();
                
                // Load all codec data
                statusInfo.textContent = 'Loading codec data...';
                await codecLoader.loadAllCodecData(codecsConfig);
                
                statusInfo.textContent = 'All codec data loaded successfully!';
                setTimeout(() => {
                    statusInfo.style.display = 'none';
                }, 2000);
                
                // Render model sections
                renderModelSections();
                
            } catch (error) {
                console.error('Error loading codec data:', error);
                statusInfo.textContent = 'Error loading codec data';
                statusInfo.style.background = '#ffebee';
                statusInfo.style.color = '#c62828';
            }
        }

        // Dynamically generate codec controls
        function renderCodecControls() {
            const controlsContainer = document.getElementById('codec-controls');
            controlsContainer.innerHTML = '';
            
            Object.entries(codecsConfig).forEach(([codecId, codecInfo], index) => {
                const checkboxGroup = document.createElement('div');
                checkboxGroup.className = 'checkbox-group';
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = `show-${codecId.toLowerCase()}`;
                checkbox.checked = index === 0; // Check first codec by default
                checkbox.addEventListener('change', renderModelSections);
                
                const label = document.createElement('label');
                label.htmlFor = `show-${codecId.toLowerCase()}`;
                label.textContent = codecInfo.displayName;
                
                const select = document.createElement('select');
                select.id = `${codecId.toLowerCase()}-freq`;
                select.addEventListener('change', renderModelSections);
                
                codecInfo.configurations.forEach((config, idx) => {
                    const option = document.createElement('option');
                    option.value = config;
                    option.textContent = config;
                    option.selected = (idx === 0); // Select first option by default
                    select.appendChild(option);
                });
                
                checkboxGroup.appendChild(checkbox);
                checkboxGroup.appendChild(label);
                checkboxGroup.appendChild(select);
                controlsContainer.appendChild(checkboxGroup);
            });
        }

        // Get audio file path
        function getAudioPath(dataset, fileId, codecId, config) {
            if (!fileId || fileId === 'Total') {
                return '';
            }

            let actualFileName = fileId;

            let dataFileName = codecLoader.getCodecData(dataset, codecId, config, fileId, 'filename');

            if (!dataFileName) {
                const firstCodecId = Object.keys(codecsConfig).find(id => document.getElementById(`show-${id.toLowerCase()}`)?.checked);
                
                if (firstCodecId) {
                    const firstConfig = document.getElementById(`${firstCodecId.toLowerCase()}-freq`)?.value;
                    dataFileName = codecLoader.getCodecData(dataset, firstCodecId, firstConfig, fileId, 'filename');
                }
            }

            if (dataFileName) {
                actualFileName = dataFileName;
            } else {
                console.warn(`No File_name found for ${fileId} in ${dataset} using any loaded codec data.`);
                return ''; 
            }
            
            return codecLoader.getAudioPath(dataset, codecId, config, actualFileName);
        }

        // Create audio control element
        function createAudioControl(dataset, fileId, codecId, config) {
            if (fileId === 'Total') {
                return '<span class="no-audio">-</span>';
            }
            
            const audioPath = getAudioPath(dataset, fileId, codecId, config);
            
            if (!audioPath) {
                return '<span class="no-audio">No File</span>';
            }
            
            let sourceTags = '';
            if (codecId === 'original') {
                const basePath = audioPath.replace(/\.[^.]+$/, '');
                sourceTags = `
                    <source src="${basePath}.flac" type="audio/flac">
                    <source src="${basePath}.mp3" type="audio/mpeg">
                    <source src="${basePath}.wav" type="audio/wav">
                `;
            } else {
                const ext = audioPath.split('.').pop();
                const mimeType = ext === 'wav' ? 'audio/wav' : ext === 'flac' ? 'audio/flac' : 'audio/mpeg';
                sourceTags = `<source src="${audioPath}" type="${mimeType}">`;
            }
            
            return `
                <div class="audio-controls">
                    <button class="play-button" onclick="toggleAudio('audio_${dataset}_${fileId}_${codecId}', this)">Play</button>
                    <audio preload="none" id="audio_${dataset}_${fileId}_${codecId}">
                        ${sourceTags}
                        Your browser does not support audio playback.
                    </audio>
                    ${config ? `<div class="codec-info">${config}</div>` : ''}
                </div>
            `;
        }
        
        // Audio playback control
        function toggleAudio(audioId, button) {
            document.querySelectorAll('audio').forEach(audio => {
                if (audio.id !== audioId) {
                    audio.pause();
                    audio.currentTime = 0;
                }
            });

            document.querySelectorAll('.play-button').forEach(btn => {
                if (btn !== button) {
                    btn.textContent = 'Play';
                    btn.disabled = false;
                }
            });

            const audio = document.getElementById(audioId);
            if (!audio) {
                console.error('Audio element not found:', audioId);
                return;
            }

            if (audio.paused) {
                button.textContent = 'Loading...';
                button.disabled = true;

                audio.addEventListener('canplay', function() {
                    button.textContent = 'Pause';
                    button.disabled = false;
                    audio.play();
                }, { once: true });

                audio.addEventListener('error', function(e) {
                    console.error('Audio load failed:', audioId, e);
                    button.textContent = 'Load Failed';
                    button.disabled = false;
                }, { once: true });

                audio.addEventListener('ended', function() {
                    button.textContent = 'Play';
                });

                audio.load();
            } else {
                audio.pause();
                button.textContent = 'Play';
            }
        }

        // Get model information
        function getModelInfo(codecId, config) {
            const datasets = codecLoader.getDatasets();
            const datasetName = Object.keys(datasets)[0];
            const data = datasets[datasetName].codecData[codecId]?.[config];
            
            if (data && data.model_info) {
                return data.model_info;
            }
            
            return {
                modelName: codecId,
                causality: 'N/A',
                trainingSet: 'N/A',
                testingSet: 'N/A',
                bitRate: 'N/A',
                parameters: {
                    frameRate: 'N/A',
                    quantizers: 'N/A',
                    codebookSize: 'N/A',
                    nParams: 'N/A'
                }
            };
        }

        // Create table row
        function createTableRow(dataset, fileId, codecId, config) {
            const datasets = codecLoader.getDatasets();
            const isErrorExample = datasets[dataset].errorExamples?.includes(fileId);
            const isTotalRow = fileId === 'Total';
            
            const showTotal = document.getElementById('show-total').checked;
            const showSample = document.getElementById('show-sample').checked;
            const showError = document.getElementById('show-error').checked;
            const sampleCount = parseInt(document.getElementById('sample-count').value);
            
            if (isTotalRow && !showTotal) return '';
            if (isErrorExample && !showError) return '';
            
            const sampleMatch = fileId.match(/^Sample_(\d+)$/);
            if (sampleMatch) {
                const sampleNumber = parseInt(sampleMatch[1]);
                if (!showSample || sampleNumber > sampleCount) return '';
            } else if (!isTotalRow && !isErrorExample && !showSample) {
                return '';
            }
            
            let rowClass = '';
            if (isTotalRow) {
                rowClass = 'total-row';
            } else if (isErrorExample) {
                rowClass = 'error-example';
            }
            
            const dwer = codecLoader.getCodecData(dataset, codecId, config, fileId, 'dwer') || 'X';
            const utmos = codecLoader.getCodecData(dataset, codecId, config, fileId, 'utmos') || 'X';
            const pesq = codecLoader.getCodecData(dataset, codecId, config, fileId, 'pesq') || 'X';
            const stoi = codecLoader.getCodecData(dataset, codecId, config, fileId, 'stoi') || 'X';
            const speakerSim = codecLoader.getCodecData(dataset, codecId, config, fileId, 'speaker_sim') || 'X';
            
            let transcription = 'X';
            let origin = 'X';
            let inference = 'X';
            
            if (!isTotalRow) {
                transcription = codecLoader.getCodecData(dataset, codecId, config, fileId, 'transcription') || 'X';
                origin = codecLoader.getCodecData(dataset, codecId, config, fileId, 'origin') || 'X';
                inference = codecLoader.getCodecData(dataset, codecId, config, fileId, 'inference') || 'X';
            } else {
                transcription = '-';
                origin = '-';
                inference = '-';
            }
            
            let displayFileName = fileId;
            if (!isTotalRow) {
                const realFileName = codecLoader.getCodecData(dataset, codecId, config, fileId, 'filename');
                if (realFileName) {
                    displayFileName = realFileName;
                }
            }
            
            let originalCell = '';
            let inferenceCell = '';
            
            if (document.getElementById('show-original').checked) {
                originalCell = `<td class="original-cell">${createAudioControl(dataset, fileId, 'original', null)}</td>`;
            }
            
            if (document.getElementById(`show-${codecId.toLowerCase()}`).checked) {
                inferenceCell = `<td class="inference-cell">${createAudioControl(dataset, fileId, codecId, config)}</td>`;
            }
            
            const dwerCell = document.getElementById('show-dwer').checked ? `<td class="metric-cell">${dwer}</td>` : '';
            const utmosCell = document.getElementById('show-utmos').checked ? `<td class="metric-cell">${utmos}</td>` : '';
            const pesqCell = document.getElementById('show-pesq').checked ? `<td class="metric-cell">${pesq}</td>` : '';
            const stoiCell = document.getElementById('show-stoi').checked ? `<td class="metric-cell">${stoi}</td>` : '';
            const speakerSimCell = document.getElementById('show-speaker-sim').checked ? `<td class="metric-cell">${speakerSim}</td>` : '';
            const transcriptionCell = document.getElementById('show-transcription').checked ? `<td class="transcript">${transcription}</td>` : '';
            const originCell = document.getElementById('show-origin').checked ? `<td class="transcript">${origin}</td>` : '';
            const inferenceTextCell = document.getElementById('show-inference').checked ? `<td class="transcript">${inference}</td>` : '';
            
            return `
                <tr class="${rowClass}">
                    <td class="file-id">${displayFileName}</td>
                    ${originalCell}
                    ${inferenceCell}
                    ${dwerCell}
                    ${utmosCell}
                    ${pesqCell}
                    ${stoiCell}
                    ${speakerSimCell}
                    ${transcriptionCell}
                    ${originCell}
                    ${inferenceTextCell}
                </tr>
            `;
        }

        // Create table headers
        function createTableHeaders(dataset, codecId) {
            let headers = '<th style="width: 120px;">File ID</th>';
            
            if (document.getElementById('show-original').checked) {
                headers += '<th class="original-header" style="width: 190px;">Original</th>';
            }
            
            if (document.getElementById(`show-${codecId.toLowerCase()}`).checked) {
                headers += '<th class="inference-header" style="width: 190px;">Inference</th>';
            }
            
            if (document.getElementById('show-dwer').checked) {
                const metricType = dataset.includes('commonvoice') ? 'dCER' : 'dWER';
                headers += `<th style="width: 90px;">${metricType}</th>`;
            }
            if (document.getElementById('show-utmos').checked) {
                headers += '<th style="width: 90px;">UTMOS</th>';
            }
            if (document.getElementById('show-pesq').checked) {
                headers += '<th style="width: 90px;">PESQ</th>';
            }
            if (document.getElementById('show-stoi').checked) {
                headers += '<th style="width: 90px;">STOI</th>';
            }
            if (document.getElementById('show-speaker-sim').checked) {
                headers += '<th style="width: 90px;">Speaker Sim</th>';
            }
            if (document.getElementById('show-transcription').checked) {
                headers += '<th style="width: 200px;">Transcription</th>';
            }
            if (document.getElementById('show-origin').checked) {
                headers += '<th style="width: 200px;">Origin</th>';
            }
            if (document.getElementById('show-inference').checked) {
                headers += '<th style="width: 200px;">Inference Text</th>';
            }
            
            return headers;
        }

        // Render model sections
        function renderModelSections() {
            if (!codecsConfig) return;
            
            const container = document.getElementById('model-sections');
            container.innerHTML = '';
            
            Object.entries(codecsConfig).forEach(([codecId, codecInfo]) => {
                const checkboxId = `show-${codecId.toLowerCase()}`;
                const selectId = `${codecId.toLowerCase()}-freq`;
                
                if (document.getElementById(checkboxId).checked) {
                    currentModel = codecId;
                    currentFrequency = document.getElementById(selectId).value;
                    container.appendChild(createModelSection(codecId, currentFrequency));
                }
            });
        }

        // Create model section
        function createModelSection(codecId, config) {
            const section = document.createElement('div');
            section.className = 'model-section';

            const modelInfo = getModelInfo(codecId, config);
            const showConfig = document.getElementById('show-config').checked;

            let configHtml = '';
            if (showConfig) {
                configHtml = `
                    <div class="model-info">
                        <div class="params-row">
                            <div class="info-item">
                                <div class="info-label">Causality</div>
                                <div class="info-value">${modelInfo.causality}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Bit-rate (kbps)</div>
                                <div class="info-value">${modelInfo.bitRate}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Frame Rate (Hz)</div>
                                <div class="info-value">${modelInfo.parameters.frameRate}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label"># of Quantizer</div>
                                <div class="info-value">${modelInfo.parameters.quantizers}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Codebook Size</div>
                                <div class="info-value">${modelInfo.parameters.codebookSize}</div>
                            </div>
                        </div>
                        
                        <table class="training-testing-table">
                            <tr>
                                <td class="label-cell">Training Set</td>
                                <td class="value-cell">${modelInfo.trainingSet}</td>
                            </tr>
                            <tr>
                                <td class="label-cell">Testing Set</td>
                                <td class="value-cell">${modelInfo.testingSet}</td>
                            </tr>
                        </table>
                    </div>
                `;
            }

            section.innerHTML = `
                <div class="model-header">${codecId}</div>
                ${configHtml}
                ${createDatasetTables(codecId, config)}
            `;

            return section;
        }

        // Create dataset tables
        function createDatasetTables(codecId, config) {
            let tablesHtml = '';
            const showDataset = document.getElementById('show-dataset').checked;
            
            if (!showDataset) {
                return '';
            }
            
            const datasets = codecLoader.getDatasets();
            const datasetType = document.getElementById('dataset-type').value;
            
            const datasetTitles = {
                'librispeech': 'LibriSpeech',
                'commonvoice': 'Common Voice'
            };
            
            let datasetsToShow = [];
            
            if (datasetType === 'both') {
                datasetsToShow = [
                    ['librispeech', datasetTitles['librispeech']],
                    ['commonvoice', datasetTitles['commonvoice']]
                ];
            } else {
                datasetsToShow = [[datasetType, datasetTitles[datasetType]]];
            }
            
            for (const [dataset, title] of datasetsToShow) {
                if (datasets[dataset]) {
                    const rows = datasets[dataset].files
                        .map(fileId => createTableRow(dataset, fileId, codecId, config))
                        .filter(row => row !== '')
                        .join('');
                    
                    if (rows) {
                        const tableHeaders = createTableHeaders(dataset, codecId);
                        tablesHtml += `
                            <div class="dataset-section">
                                <div class="dataset-title">${title}</div>
                                <table>
                                    <thead>
                                        <tr>
                                            ${tableHeaders}
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${rows}
                                    </tbody>
                                </table>
                            </div>
                        `;
                    }
                }
            }
            
            return tablesHtml;
        }
        
        // Event listeners
        document.getElementById('dataset-type').addEventListener('change', renderModelSections);
        document.getElementById('sample-count').addEventListener('change', renderModelSections);
        
        [
            'show-original', 'show-total', 'show-sample', 'show-error', 'show-config', 'show-dataset',
            'show-dwer', 'show-utmos', 'show-pesq', 'show-stoi', 'show-speaker-sim',
            'show-transcription', 'show-origin', 'show-inference'
        ].forEach(id => {
            document.getElementById(id).addEventListener('change', renderModelSections);
        });
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadAllCodecData();
        });
    </script>
</body>
</html>