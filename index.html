<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neural Audio Codec Inference Result Comparison</title>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 30px;
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        
        .controls {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        
        .control-row {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .control-row:last-child {
            margin-bottom: 0;
        }
        
        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
            background: white;
            padding: 8px 12px;
            border-radius: 4px;
            border: 1px solid #e0e0e0;
            flex: 1;
            min-width: 0;
        }
        
        .control-group label {
            font-weight: bold;
            color: #555;
            margin-right: 10px;
        }
        
        .control-group.first-aligned label {
            min-width: 60px;
            text-align: left;
        }
        
        .control-subgroup {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: 10px;
            flex-wrap: wrap;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .checkbox-group input[type="checkbox"] {
            margin-right: 5px;
        }
        
        .checkbox-group label {
            font-weight: normal;
            color: #555;
            font-size: 14px;
        }
        
        .checkbox-group .compact {
            margin-left: 2px;
        }
        
        select {
            padding: 4px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            min-width: 70px;
            font-size: 12px;
        }
        
        select.compact {
            padding: 2px 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
            min-width: 40px;
            font-size: 12px;
            margin-left: 2px;
        }
        
        .status-info {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        .model-section {
            margin-bottom: 50px;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .model-header {
            background: #495057;
            color: white;
            padding: 15px 20px;
            font-size: 18px;
            font-weight: bold;
        }
        
        .model-info {
            background: #f8f9fa;
            padding: 15px 20px;
            border-bottom: 1px solid #ddd;
        }
        
        .params-row {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .info-item {
            display: flex;
            flex-direction: column;
            text-align: center;
        }
        
        .info-label {
            font-size: 12px;
            color: #666;
            font-weight: bold;
            margin-bottom: 2px;
        }
        
        .info-value {
            font-size: 14px;
            color: #333;
        }
        
        .training-testing-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        .training-testing-table td {
            border: 1px solid #ddd;
            padding: 10px;
            vertical-align: top;
        }
        
        .training-testing-table .label-cell {
            background: #e9ecef;
            font-weight: bold;
            width: 150px;
            text-align: center;
        }
        
        .training-testing-table .value-cell {
            background: white;
        }
        
        .dataset-section {
            margin-bottom: 30px;
        }
        
        .dataset-title {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
            padding: 8px 15px;
            background: #e9ecef;
            border-radius: 5px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            font-size: 12px;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 8px 6px;
            text-align: center;
            vertical-align: middle;
        }
        
        th {
            background-color: #f8f9fa;
            font-weight: bold;
            color: #495057;
            font-size: 11px;
        }
        
        .file-id {
            font-family: monospace;
            font-size: 11px;
            font-weight: bold;
            color: #495057;
            text-align: left;
            padding-left: 10px;
            min-width: 120px;
        }
        
        .audio-controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 3px;
        }
        
        .codec-info {
            font-size: 10px;
            color: #666;
            margin-top: 2px;
        }
        
        .transcript {
            max-width: 200px;
            text-align: left;
            font-size: 10px;
            line-height: 1.3;
            color: #555;
            padding: 4px;
        }
        
        .play-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            margin-bottom: 3px;
        }
        
        .play-button:hover {
            background: #0056b3;
        }
        
        .play-button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }

        .total-row {
            background-color: #e3f2fd !important;
            font-weight: bold;
        }

        .error-example {
            background-color: rgba(255, 193, 193, 0.3) !important;
        }
        
        .error-example .file-id {
            color: #d32f2f;
            font-weight: bold;
        }

        .no-audio {
            color: #666;
            font-style: italic;
        }

        .metric-cell {
            font-size: 12px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Neural Audio Codec Inference Result Comparison</h1>
        <div class="status-info" id="status-info">
            Loading codec data...
        </div>
        
        <div class="controls">
            <div class="control-row">
                <div class="control-group first-aligned">
                    <label>NACs</label>
                    <div class="control-subgroup">
                        <div class="checkbox-group">
                            <input type="checkbox" id="show-lscodec" checked>
                            <label for="show-lscodec">LSCodec</label>
                            <select id="lscodec-freq">
                                <option value="25Hz">25Hz</option>
                                <option value="50Hz">50Hz</option>
                            </select>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="show-focalcodec" checked>
                            <label for="show-focalcodec">FocalCodec</label>
                            <select id="focalcodec-freq">
                                <option value="12.5Hz">12.5Hz</option>
                                <option value="25Hz">25Hz</option>
                                <option value="50Hz">50Hz</option>
                            </select>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="show-bigcodec" checked>
                            <label for="show-bigcodec">BigCodec</label>
                            <select id="bigcodec-freq">
                                <option value="80Hz">80Hz</option>
                            </select>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="show-secousticodec" checked>
                            <label for="show-secousticodec">SecoustiCodec</label>
                            <select id="secousticodec-freq">
                                <option value="20Hz">20Hz</option>
                                <option value="80Hz">80Hz</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="control-row">
                <div class="control-group first-aligned">
                    <label>Result</label>
                    <div class="control-subgroup">
                        <div class="checkbox-group">
                            <input type="checkbox" id="show-config" checked>
                            <label for="show-config">Config</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="show-original" checked>
                            <label for="show-original">Original</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="show-total" checked>
                            <label for="show-total">Total</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="show-sample" checked>
                            <label for="show-sample">Sample</label>
                            <select id="sample-count" class="compact">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5" selected>5</option>
                            </select>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="show-error" checked>
                            <label for="show-error">Error Sample</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="control-row">
                <div class="control-group first-aligned">
                    <label>Dataset</label>
                    <div class="control-subgroup">
                        <div class="checkbox-group">
                            <input type="checkbox" id="show-dataset" checked>
                            <label for="show-dataset">Dataset</label>
                            <select id="dataset-type">
                                <option value="librispeech">LibriSpeech</option>
                                <option value="commonvoice">Common Voice</option>
                                <option value="both" selected>LibriSpeech + Common Voice</option>
                            </select>
                            <select id="dataset-variant">
                                <option value="clean" selected>Clean</option>
                                <option value="clean-noise">Clean+Noise</option>
                                <option value="clean-blank">Clean+Blank</option>
                                <option value="all">Clean+Noise+Blank</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="control-row">
                <div class="control-group first-aligned">
                    <label>Metrics</label>
                    <div class="control-subgroup">
                        <div class="checkbox-group">
                            <input type="checkbox" id="show-dwer" checked>
                            <label for="show-dwer">dWER/dCER</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="show-utmos" checked>
                            <label for="show-utmos">UTMOS</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="show-pesq" checked>
                            <label for="show-pesq">PESQ</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="show-stoi" checked>
                            <label for="show-stoi">STOI</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="control-row">
                <div class="control-group first-aligned">
                    <label>Text</label>
                    <div class="control-subgroup">
                        <div class="checkbox-group">
                            <input type="checkbox" id="show-transcription">
                            <label for="show-transcription">Transcription</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="show-origin">
                            <label for="show-origin">Origin</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="show-inference">
                            <label for="show-inference">Inference</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="model-sections"></div>
    </div>

    <script>
        const datasets = {
            librispeech: {
                files: ['Total', 'Sample_1', 'Sample_2', 'Sample_3', 'Sample_4', 'Sample_5', 'Error_Sample_1'],
                errorExamples: ['Error_Sample_1'],
                codecData: {}
            },
            'librispeech-noise': {
                files: ['Total', 'Sample_1', 'Sample_2', 'Sample_3', 'Sample_4', 'Sample_5', 'Error_Sample_1'],
                errorExamples: ['Error_Sample_1'],
                codecData: {}
            },
            'librispeech-blank': {
                files: ['Total', 'Sample_1', 'Sample_2', 'Sample_3', 'Sample_4', 'Sample_5', 'Error_Sample_1'],
                errorExamples: ['Error_Sample_1'],
                codecData: {}
            },
            commonvoice: {
                files: ['Total', 'Sample_1', 'Sample_2', 'Sample_3', 'Sample_4', 'Sample_5', 'Error_Sample_1'],
                errorExamples: ['Error_Sample_1'],
                codecData: {}
            },
            'commonvoice-noise': {
                files: ['Total', 'Sample_1', 'Sample_2', 'Sample_3', 'Sample_4', 'Sample_5', 'Error_Sample_1'],
                errorExamples: ['Error_Sample_1'],
                codecData: {}
            },
            'commonvoice-blank': {
                files: ['Total', 'Sample_1', 'Sample_2', 'Sample_3', 'Sample_4', 'Sample_5', 'Error_Sample_1'],
                errorExamples: ['Error_Sample_1'],
                codecData: {}
            }
        };

        let currentModel = 'LSCodec';
        let currentFrequency = '50Hz';

        async function loadCodecData(dataset, codecType, frequency) {
            const basePath = `configs`;
            const jsonPath = `${basePath}/${codecType}_${frequency}_config.json`;
            
            try {
                const response = await fetch(jsonPath);
                if (response.ok) {
                    const data = await response.json();
                    
                    if (!datasets[dataset].codecData[codecType]) {
                        datasets[dataset].codecData[codecType] = {};
                    }
                    datasets[dataset].codecData[codecType][frequency] = data;
                    
                    return data;
                } else {
                    console.warn(`Failed to load ${jsonPath}: ${response.status}`);
                    return null;
                }
            } catch (error) {
                console.error(`Error loading ${jsonPath}:`, error);
                return null;
            }
        }

        async function loadAllCodecData() {
            const statusInfo = document.getElementById('status-info');
            const loadPromises = [];
            
            const datasetNames = Object.keys(datasets);
            
            for (const datasetName of datasetNames) {
                statusInfo.textContent = `Loading ${datasetName} data...`;
                loadPromises.push(loadCodecData(datasetName, 'LSCodec', '25Hz'));
                loadPromises.push(loadCodecData(datasetName, 'LSCodec', '50Hz'));
                loadPromises.push(loadCodecData(datasetName, 'FocalCodec', '12.5Hz'));
                loadPromises.push(loadCodecData(datasetName, 'FocalCodec', '25Hz'));
                loadPromises.push(loadCodecData(datasetName, 'FocalCodec', '50Hz'));
                loadPromises.push(loadCodecData(datasetName, 'BigCodec', '80Hz'));
                loadPromises.push(loadCodecData(datasetName, 'SecoustiCodec', '20Hz'));
                loadPromises.push(loadCodecData(datasetName, 'SecoustiCodec', '80Hz'));
            }
            
            await Promise.all(loadPromises);
            
            statusInfo.textContent = 'All codec data loaded successfully!';
            setTimeout(() => {
                statusInfo.style.display = 'none';
            }, 2000);
            
            renderModelSections();
        }

        function getCodecData(dataset, codecType, frequency, fileId, dataType) {
            try {
                const codecData = datasets[dataset].codecData[codecType]?.[frequency];
                if (!codecData) return null;
                
                const datasetKey = getDatasetKey(dataset);
                const fileData = codecData[datasetKey]?.[fileId];
                
                if (!fileData) return null;
                
                switch (dataType) {
                    case 'transcription':
                        return fileData.Transcription || null;
                    case 'origin':
                        return fileData.Origin || null;
                    case 'inference':
                        return fileData.Inference || null;
                    case 'utmos':
                        return fileData.UTMOS || null;
                    case 'dwer':
                        return fileData.dWER || fileData.dCER || null;
                    case 'dwer_type':
                        if (fileData.dWER !== undefined) return 'dWER';
                        if (fileData.dCER !== undefined) return 'dCER';
                        return null;
                    case 'pesq':
                        return fileData.PESQ || null;
                    case 'stoi':
                        return fileData.STOI || null;
                    case 'filename':
                        return fileData.File_name || null;
                    default:
                        return null;
                }
            } catch (error) {
                console.error('Error getting codec data:', error);
                return null;
            }
        }

        function getDatasetKey(dataset) {
            switch(dataset) {
                case 'librispeech':
                    return 'LibriSpeech';
                case 'librispeech-noise':
                    return 'LibriSpeech_Noise';
                case 'librispeech-blank':
                    return 'LibriSpeech_Blank';
                case 'commonvoice':
                    return 'CommonVoice';
                case 'commonvoice-noise':
                    return 'CommonVoice_Noise';
                case 'commonvoice-blank':
                    return 'CommonVoice_Blank';
                default:
                    return 'LibriSpeech';
            }
        }

        function getAudioPath(dataset, fileId, codecType, frequency = null) {
            const basePath = `audio`;
            const datasetPath = getDatasetKey(dataset).replace('_', '/');
            
            if (fileId === 'Total') {
                return '';
            }
            
            const actualFileName = getCodecData(dataset, currentModel, currentFrequency, fileId, 'filename');
            if (!actualFileName) {
                console.warn(`No File_name found for ${fileId} in ${dataset}`);
                return '';
            }
            
            switch(codecType) {
                case 'original':
                    return `${basePath}/${datasetPath}/original/${actualFileName}.flac`;
                case 'lscodec':
                    return `${basePath}/${datasetPath}/LSCodec/${frequency}/${actualFileName}.wav`;
                case 'focalcodec':
                    return `${basePath}/${datasetPath}/FocalCodec/${frequency}/${actualFileName}.wav`;
                case 'bigcodec':
                    return `${basePath}/${datasetPath}/BigCodec/${frequency}/${actualFileName}.wav`;
                case 'secousticodec':
                    return `${basePath}/${datasetPath}/SecoustiCodec/${frequency}/${actualFileName}.wav`;
                default:
                    return '';
            }
        }

        function createAudioControl(dataset, fileId, codecType, frequency = null) {
            if (fileId === 'Total') {
                return '<span class="no-audio">-</span>';
            }
            
            const audioPath = getAudioPath(dataset, fileId, codecType, frequency);
            
            if (!audioPath) {
                return '<span class="no-audio">No File</span>';
            }
            
            // For original files, try multiple formats
            let sourceTags = '';
            if (codecType === 'original') {
                const basePath = audioPath.replace(/\.[^.]+$/, ''); // Remove extension
                sourceTags = `
                    <source src="${basePath}.flac" type="audio/flac">
                    <source src="${basePath}.mp3" type="audio/mpeg">
                    <source src="${basePath}.wav" type="audio/wav">
                `;
            } else {
                // For inference files, use the specific format
                const ext = audioPath.split('.').pop();
                const mimeType = ext === 'wav' ? 'audio/wav' : ext === 'flac' ? 'audio/flac' : 'audio/mpeg';
                sourceTags = `<source src="${audioPath}" type="${mimeType}">`;
            }
            
            return `
                <div class="audio-controls">
                    <button class="play-button" onclick="toggleAudio('audio_${dataset}_${fileId}_${codecType}', this)">Play</button>
                    <audio preload="none" id="audio_${dataset}_${fileId}_${codecType}">
                        ${sourceTags}
                        Your browser does not support audio playback.
                    </audio>
                    ${frequency ? `<div class="codec-info">${frequency}</div>` : ''}
                </div>
            `;
        }
        
        function toggleAudio(audioId, button) {
            // Pause all other audio elements
            document.querySelectorAll('audio').forEach(audio => {
                if (audio.id !== audioId) {
                    audio.pause();
                    audio.currentTime = 0;
                }
            });

            // Reset all other play buttons
            document.querySelectorAll('.play-button').forEach(btn => {
                if (btn !== button) {
                    btn.textContent = 'Play';
                    btn.disabled = false;
                }
            });

            const audio = document.getElementById(audioId);
            if (!audio) {
                console.error('Audio element not found:', audioId);
                return;
            }

            if (audio.paused) {
                button.textContent = 'Loading...';
                button.disabled = true;

                audio.addEventListener('canplay', function() {
                    button.textContent = 'Pause';
                    button.disabled = false;
                    audio.play();
                }, { once: true });

                audio.addEventListener('error', function(e) {
                    console.error('Audio load failed:', audioId, e);
                    button.textContent = 'Load Failed';
                    button.disabled = false;
                }, { once: true });

                audio.addEventListener('ended', function() {
                    button.textContent = 'Play';
                });

                audio.load();
            } else {
                audio.pause();
                button.textContent = 'Play';
            }
        }

        function getModelInfo(codecType, frequency) {
            const datasetName = Object.keys(datasets)[0];
            const data = datasets[datasetName].codecData[codecType]?.[frequency];
            
            if (data && data.model_info) {
                return data.model_info;
            }
            
            return {
                modelName: codecType,
                causality: 'N/A',
                trainingSet: 'N/A',
                testingSet: 'N/A',
                bitRate: 'N/A',
                parameters: {
                    frameRate: 'N/A',
                    quantizers: 'N/A',
                    codebookSize: 'N/A',
                    nParams: 'N/A'
                }
            };
        }

        function createTableRow(dataset, fileId) {
            const codecType = currentModel;
            const frequency = currentFrequency;
            
            const isErrorExample = datasets[dataset].errorExamples?.includes(fileId);
            const isTotalRow = fileId === 'Total';
            
            const showTotal = document.getElementById('show-total').checked;
            const showSample = document.getElementById('show-sample').checked;
            const showError = document.getElementById('show-error').checked;
            const sampleCount = parseInt(document.getElementById('sample-count').value);
            
            if (isTotalRow && !showTotal) return '';
            if (isErrorExample && !showError) return '';
            
            const sampleMatch = fileId.match(/^Sample_(\d+)$/);
            if (sampleMatch) {
                const sampleNumber = parseInt(sampleMatch[1]);
                if (!showSample || sampleNumber > sampleCount) return '';
            } else if (!isTotalRow && !isErrorExample && !showSample) {
                return '';
            }
            
            let rowClass = '';
            if (isTotalRow) {
                rowClass = 'total-row';
            } else if (isErrorExample) {
                rowClass = 'error-example';
            }
            
            const dwer = getCodecData(dataset, codecType, frequency, fileId, 'dwer') || 'X';
            const utmos = getCodecData(dataset, codecType, frequency, fileId, 'utmos') || 'X';
            const pesq = getCodecData(dataset, codecType, frequency, fileId, 'pesq') || 'X';
            const stoi = getCodecData(dataset, codecType, frequency, fileId, 'stoi') || 'X';
            
            let transcription = 'X';
            let origin = 'X';
            let inference = 'X';
            
            if (!isTotalRow) {
                transcription = getCodecData(dataset, codecType, frequency, fileId, 'transcription') || 'X';
                origin = getCodecData(dataset, codecType, frequency, fileId, 'origin') || 'X';
                inference = getCodecData(dataset, codecType, frequency, fileId, 'inference') || 'X';
            } else {
                transcription = '-';
                origin = '-';
                inference = '-';
            }
            
            let displayFileName = fileId;
            if (!isTotalRow) {
                const realFileName = getCodecData(dataset, codecType, frequency, fileId, 'filename');
                if (realFileName) {
                    displayFileName = realFileName;
                }
            }
            
            let originalCell = '';
            let inferenceCell = '';
            
            if (document.getElementById('show-original').checked) {
                originalCell = `<td class="original-cell">${createAudioControl(dataset, fileId, 'original')}</td>`;
            }
            
            if (codecType === 'LSCodec' && document.getElementById('show-lscodec').checked) {
                inferenceCell = `<td class="inference-cell">${createAudioControl(dataset, fileId, 'lscodec', frequency)}</td>`;
            } else if (codecType === 'FocalCodec' && document.getElementById('show-focalcodec').checked) {
                inferenceCell = `<td class="inference-cell">${createAudioControl(dataset, fileId, 'focalcodec', frequency)}</td>`;
            } else if (codecType === 'BigCodec' && document.getElementById('show-bigcodec').checked) {
                inferenceCell = `<td class="inference-cell">${createAudioControl(dataset, fileId, 'bigcodec', frequency)}</td>`;
            } else if (codecType === 'SecoustiCodec' && document.getElementById('show-secousticodec').checked) {
                inferenceCell = `<td class="inference-cell">${createAudioControl(dataset, fileId, 'secousticodec', frequency)}</td>`;
            }
            
            const dwerCell = document.getElementById('show-dwer').checked ? `<td class="metric-cell">${dwer}</td>` : '';
            const utmosCell = document.getElementById('show-utmos').checked ? `<td class="metric-cell">${utmos}</td>` : '';
            const pesqCell = document.getElementById('show-pesq').checked ? `<td class="metric-cell">${pesq}</td>` : '';
            const stoiCell = document.getElementById('show-stoi').checked ? `<td class="metric-cell">${stoi}</td>` : '';
            const transcriptionCell = document.getElementById('show-transcription').checked ? `<td class="transcript">${transcription}</td>` : '';
            const originCell = document.getElementById('show-origin').checked ? `<td class="transcript">${origin}</td>` : '';
            const inferenceTextCell = document.getElementById('show-inference').checked ? `<td class="transcript">${inference}</td>` : '';
            
            return `
                <tr class="${rowClass}">
                    <td class="file-id">${displayFileName}</td>
                    ${originalCell}
                    ${inferenceCell}
                    ${dwerCell}
                    ${utmosCell}
                    ${pesqCell}
                    ${stoiCell}
                    ${transcriptionCell}
                    ${originCell}
                    ${inferenceTextCell}
                </tr>
            `;
        }

        function createTableHeaders() {
            let headers = '<th style="width: 120px;">File ID</th>';
            
            if (document.getElementById('show-original').checked) {
                headers += '<th class="original-header" style="width: 190px;">Original</th>';
            }
            
            if ((currentModel === 'LSCodec' && document.getElementById('show-lscodec').checked) ||
                (currentModel === 'FocalCodec' && document.getElementById('show-focalcodec').checked) ||
                (currentModel === 'BigCodec' && document.getElementById('show-bigcodec').checked) ||
                (currentModel === 'SecoustiCodec' && document.getElementById('show-secousticodec').checked)) {
                headers += '<th class="inference-header" style="width: 190px;">Inference</th>';
            }
            
            if (document.getElementById('show-dwer').checked) {
                const metricType = getCurrentMetricType();
                headers += `<th style="width: 90px;">${metricType}</th>`;
            }
            if (document.getElementById('show-utmos').checked) {
                headers += '<th style="width: 90px;">UTMOS</th>';
            }
            if (document.getElementById('show-pesq').checked) {
                headers += '<th style="width: 90px;">PESQ</th>';
            }
            if (document.getElementById('show-stoi').checked) {
                headers += '<th style="width: 90px;">STOI</th>';
            }
            if (document.getElementById('show-transcription').checked) {
                headers += '<th style="width: 200px;">Transcription</th>';
            }
            if (document.getElementById('show-origin').checked) {
                headers += '<th style="width: 200px;">Origin</th>';
            }
            if (document.getElementById('show-inference').checked) {
                headers += '<th style="width: 200px;">Inference Text</th>';
            }
            
            return headers;
        }

        function getCurrentMetricType() {
            const datasetKeys = Object.keys(datasets);
            for (const dataset of datasetKeys) {
                try {
                    const codecData = datasets[dataset].codecData[currentModel]?.[currentFrequency];
                    if (!codecData) continue;
                    
                    const datasetKey = getDatasetKey(dataset);
                    const datasetData = codecData[datasetKey];
                    if (!datasetData) continue;
                    
                    const filesToCheck = ['Total', 'Sample_1', 'Sample_2', 'Sample_3', 'Sample_4', 'Sample_5'];
                    for (const fileId of filesToCheck) {
                        const fileData = datasetData[fileId];
                        if (fileData) {
                            if (fileData.dWER !== undefined) {
                                return 'dWER';
                            }
                            if (fileData.dCER !== undefined) {
                                return 'dCER';
                            }
                        }
                    }
                } catch (error) {
                    console.error('Error checking metric type:', error);
                }
            }
            return 'dWER/dCER';
        }

        function renderModelSections() {
            const container = document.getElementById('model-sections');
            container.innerHTML = '';
            
            const showLSCodec = document.getElementById('show-lscodec').checked;
            const showFocalCodec = document.getElementById('show-focalcodec').checked;
            const showBigCodec = document.getElementById('show-bigcodec').checked;
            const showSecoustiCodec = document.getElementById('show-secousticodec').checked;
            
            if (showLSCodec) {
                currentModel = 'LSCodec';
                currentFrequency = document.getElementById('lscodec-freq').value;
                container.appendChild(createModelSection('LSCodec', currentFrequency));
            }
            
            if (showFocalCodec) {
                currentModel = 'FocalCodec';
                currentFrequency = document.getElementById('focalcodec-freq').value;
                container.appendChild(createModelSection('FocalCodec', currentFrequency));
            }
            
            if (showBigCodec) {
                currentModel = 'BigCodec';
                currentFrequency = document.getElementById('bigcodec-freq').value;
                container.appendChild(createModelSection('BigCodec', currentFrequency));
            }
            
            if (showSecoustiCodec) {
                currentModel = 'SecoustiCodec';
                currentFrequency = document.getElementById('secousticodec-freq').value;
                container.appendChild(createModelSection('SecoustiCodec', currentFrequency));
            }
        }

        function createModelSection(codecType, frequency) {
            const section = document.createElement('div');
            section.className = 'model-section';

            const modelInfo = getModelInfo(codecType, frequency);
            const showConfig = document.getElementById('show-config').checked;

            let configHtml = '';
            if (showConfig) {
                configHtml = `
                    <div class="model-info">
                        <div class="params-row">
                            <div class="info-item">
                                <div class="info-label">Causality</div>
                                <div class="info-value">${modelInfo.causality}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Bit-rate (kbps)</div>
                                <div class="info-value">${modelInfo.bitRate}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Frame Rate (Hz)</div>
                                <div class="info-value">${modelInfo.parameters.frameRate}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label"># of Quantizer</div>
                                <div class="info-value">${modelInfo.parameters.quantizers}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Codebook Size</div>
                                <div class="info-value">${modelInfo.parameters.codebookSize}</div>
                            </div>
                        </div>
                        
                        <table class="training-testing-table">
                            <tr>
                                <td class="label-cell">Training Set</td>
                                <td class="value-cell">${modelInfo.trainingSet}</td>
                            </tr>
                            <tr>
                                <td class="label-cell">Testing Set</td>
                                <td class="value-cell">${modelInfo.testingSet}</td>
                            </tr>
                        </table>
                    </div>
                `;
            }

            section.innerHTML = `
                <div class="model-header">${codecType}</div>
                ${configHtml}
                ${createDatasetTables(codecType, frequency)}
            `;

            return section;
        }

        function createDatasetTables(codecType, frequency) {
            currentModel = codecType;
            currentFrequency = frequency;
            
            let tablesHtml = '';
            const showDataset = document.getElementById('show-dataset').checked;
            const datasetType = document.getElementById('dataset-type').value;
            const datasetVariant = document.getElementById('dataset-variant').value;
            
            if (!showDataset) {
                return '';
            }
            
            const datasetTitles = {
                'librispeech': 'LibriSpeech',
                'librispeech-noise': 'LibriSpeech (Noise)', 
                'librispeech-blank': 'LibriSpeech (Blank)',
                'commonvoice': 'Common Voice',
                'commonvoice-noise': 'Common Voice (Noise)', 
                'commonvoice-blank': 'Common Voice (Blank)'
            };
            
            let datasetsToShow = [];
            
            if (datasetType === 'both') {
                if (datasetVariant === 'clean') {
                    datasetsToShow = [
                        ['librispeech', datasetTitles['librispeech']],
                        ['commonvoice', datasetTitles['commonvoice']]
                    ];
                } else if (datasetVariant === 'clean-noise') {
                    datasetsToShow = [
                        ['librispeech', datasetTitles['librispeech']],
                        ['librispeech-noise', datasetTitles['librispeech-noise']],
                        ['commonvoice', datasetTitles['commonvoice']],
                        ['commonvoice-noise', datasetTitles['commonvoice-noise']]
                    ];
                } else if (datasetVariant === 'clean-blank') {
                    datasetsToShow = [
                        ['librispeech', datasetTitles['librispeech']],
                        ['librispeech-blank', datasetTitles['librispeech-blank']],
                        ['commonvoice', datasetTitles['commonvoice']],
                        ['commonvoice-blank', datasetTitles['commonvoice-blank']]
                    ];
                } else if (datasetVariant === 'all') {
                    datasetsToShow = [
                        ['librispeech', datasetTitles['librispeech']],
                        ['librispeech-noise', datasetTitles['librispeech-noise']],
                        ['librispeech-blank', datasetTitles['librispeech-blank']],
                        ['commonvoice', datasetTitles['commonvoice']],
                        ['commonvoice-noise', datasetTitles['commonvoice-noise']],
                        ['commonvoice-blank', datasetTitles['commonvoice-blank']]
                    ];
                }
            } else {
                if (datasetVariant === 'clean') {
                    datasetsToShow = [[datasetType, datasetTitles[datasetType]]];
                } else if (datasetVariant === 'clean-noise') {
                    datasetsToShow = [
                        [datasetType, datasetTitles[datasetType]],
                        [`${datasetType}-noise`, datasetTitles[`${datasetType}-noise`]]
                    ];
                } else if (datasetVariant === 'clean-blank') {
                    datasetsToShow = [
                        [datasetType, datasetTitles[datasetType]],
                        [`${datasetType}-blank`, datasetTitles[`${datasetType}-blank`]]
                    ];
                } else if (datasetVariant === 'all') {
                    datasetsToShow = [
                        [datasetType, datasetTitles[datasetType]],
                        [`${datasetType}-noise`, datasetTitles[`${datasetType}-noise`]],
                        [`${datasetType}-blank`, datasetTitles[`${datasetType}-blank`]]
                    ];
                }
            }
            
            for (const [dataset, title] of datasetsToShow) {
                if (datasets[dataset]) {
                    const rows = datasets[dataset].files
                        .map(fileId => createTableRow(dataset, fileId))
                        .filter(row => row !== '')
                        .join('');
                    
                    if (rows) {
                        const tableHeaders = createTableHeaders();
                        tablesHtml += `
                            <div class="dataset-section">
                                <div class="dataset-title">${title}</div>
                                <table>
                                    <thead>
                                        <tr>
                                            ${tableHeaders}
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${rows}
                                    </tbody>
                                </table>
                            </div>
                        `;
                    }
                }
            }
            
            return tablesHtml;
        }
        
        document.getElementById('lscodec-freq').addEventListener('change', renderModelSections);
        document.getElementById('focalcodec-freq').addEventListener('change', renderModelSections);
        document.getElementById('bigcodec-freq').addEventListener('change', renderModelSections);
        document.getElementById('secousticodec-freq').addEventListener('change', renderModelSections);
        document.getElementById('dataset-type').addEventListener('change', renderModelSections);
        document.getElementById('dataset-variant').addEventListener('change', renderModelSections);
        document.getElementById('sample-count').addEventListener('change', renderModelSections);
        
        [
            'show-lscodec', 'show-focalcodec', 'show-bigcodec', 'show-secousticodec',
            'show-original', 'show-total', 'show-sample', 'show-error', 'show-config', 'show-dataset',
            'show-dwer', 'show-utmos', 'show-pesq', 'show-stoi', 
            'show-transcription', 'show-origin', 'show-inference'
        ].forEach(id => {
            document.getElementById(id).addEventListener('change', renderModelSections);
        });
        
        document.addEventListener('DOMContentLoaded', function() {
            loadAllCodecData();
        });
    </script>
</body>
</html>